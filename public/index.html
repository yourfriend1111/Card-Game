<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Card Game - Deck Builder & Online Play</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Card Game</h1>
    
    <!-- Mode Selection -->
    <div class="mode-selection" id="mode-selection">
      <div class="mode-buttons">
        <button class="mode-btn active" id="deck-builder-mode-btn">Deck Builder</button>
        <button class="mode-btn" id="online-play-mode-btn">Online Play</button>
      </div>
    </div>

    <!-- Deck Builder Mode -->
    <div class="app-container" id="deck-builder-container">
      <!-- Card Preview Section -->
      <div class="card-preview-section">
        <h2>Card Preview</h2>
        <div class="card-preview-container" id="card-preview-container">
          <img id="card-preview-image" class="card-preview-image" alt="Card Preview">
          <div class="card-preview-info" id="card-preview-info">
            <div class="preview-empty-message">Select a card to view details</div>
          </div>
        </div>
      </div>
      
      <!-- Card Collection -->
      <div class="card-collection">
        <div class="collection-header">
          <h2>Card Collection</h2>
          <div class="search-filter">
            <input type="text" id="search-input" placeholder="Search cards..." class="deck-name-input">
          </div>
        </div>
        <div class="filter-controls">
          <button class="filter-btn active" data-filter="all">All</button>
          <button class="filter-btn" data-filter="Ranged">Ranged</button>
          <button class="filter-btn" data-filter="Melee">Melee</button>
          <button class="filter-btn" data-filter="Flying">Flying</button>
          <button class="filter-btn" data-filter="Equipment">Equipment</button>
          <button class="filter-btn" data-filter="Buff">Buff</button>
          <button class="filter-btn" data-filter="Debuff">Debuff</button>
          <button class="filter-btn" data-filter="Building">Building</button>
          <button class="filter-btn" data-filter="Terrain">Terrain</button>
        </div>
        <div class="cards-grid" id="card-collection"></div>
      </div>

      <!-- Deck Builder -->
      <div class="deck-builder">
        <div class="deck-controls">
          <h2>Current Deck</h2>
          <button id="draw-cards-btn">Test Draw</button>
        </div>
        <div class="deck-stats">
          <div class="stat-box" id="card-count">Cards: 0/40</div>
          <div class="stat-box" id="avg-energy">Avg Energy: 0</div>
          <div class="stat-box" id="type-distribution">Types: 0</div>
        </div>
        <div class="deck-list" id="current-deck">
          <div class="empty-deck-message">Click a card to add it to your deck</div>
        </div>
        <div class="save-load-controls">
          <div class="save-deck">
            <input type="text" id="deck-name" placeholder="Deck Name" class="deck-name-input">
            <button id="save-deck-btn">Save Deck</button>
          </div>
          <button id="clear-deck-btn">Clear Deck</button>
        </div>
        <div class="saved-decks">
          <h3>Saved Decks</h3>
          <div id="saved-decks-list"></div>
        </div>
      </div>
    </div>

    <!-- Online Play Mode -->
    <div class="online-container hidden" id="online-container">
      <!-- Room Selection -->
      <div class="room-selection" id="room-selection">
        <h2>Join or Create Game</h2>
        <div class="room-controls">
          <div class="join-room">
            <input type="text" id="room-id-input" placeholder="Enter Room ID" class="deck-name-input">
            <button id="join-room-btn">Join Room</button>
          </div>
          <div class="create-room">
            <button id="create-room-btn">Create New Room</button>
          </div>
        </div>
        <div class="deck-selection">
          <h3>Select Your Deck</h3>
          <select id="deck-selector" class="deck-name-input">
            <option value="">Choose a saved deck...</option>
          </select>
        </div>
        <div class="connection-status" id="connection-status">
          <span class="status-indicator offline" id="status-indicator"></span>
          <span id="status-text">Connecting...</span>
        </div>
      </div>

      <!-- Game Lobby -->
      <div class="game-lobby hidden" id="game-lobby">
        <h2>Game Lobby</h2>
        <div class="lobby-info">
          <div class="room-info">
            <h3>Room: <span id="current-room-id"></span></h3>
            <div class="player-list" id="player-list"></div>
          </div>
          <div class="ready-controls">
            <button id="ready-btn" class="ready-btn">Ready</button>
            <button id="leave-room-btn" class="leave-btn">Leave Room</button>
          </div>
        </div>
      </div>

      <!-- Game Board -->
      <div class="game-board hidden" id="game-board">
        <!-- Game Header with Controls -->
        <div class="game-header">
          <div class="game-info">
            <div class="turn-info">
              <span id="turn-display">Turn 1 - Phase 1</span>
              <span id="current-player-display">Waiting...</span>
            </div>
            <div class="player-stats">
              <div class="player-stat">
                <span>Your Health: </span><span id="your-health">100</span>
              </div>
              <div class="player-stat">
                <span>Your Energy: </span><span id="your-energy">5</span>
              </div>
              <div class="player-stat">
                <span>Opponent Health: </span><span id="opponent-health">100</span>
              </div>
              <div class="player-stat">
                <span>Army Size: </span><span id="your-army-size">0</span> / <span id="opponent-army-size">0</span>
              </div>
            </div>
          </div>
          <div class="game-controls">
            <button id="end-turn-btn" class="end-turn-btn">End Turn</button>
            <button id="forfeit-btn" class="forfeit-btn">Forfeit</button>
            <button id="toggle-grid-btn" class="toggle-btn">Toggle Grid</button>
          </div>
        </div>
        
        <!-- Main Game Area -->
        <div class="game-main">
          <!-- Left Sidebar - Selected Unit Info -->
          <div class="unit-info-panel">
            <h3>Unit Details</h3>
            <div id="selected-unit-info" class="selected-unit-display">
              <div class="no-selection">Click a unit to view details</div>
            </div>
            
            <!-- Action Buttons for Selected Unit -->
            <div class="unit-actions" id="unit-actions" style="display: none;">
              <button id="move-unit-btn" class="action-btn">Move</button>
              <button id="attack-unit-btn" class="action-btn">Attack</button>
              <button id="cancel-selection-btn" class="action-btn secondary">Cancel</button>
            </div>
          </div>
          
          <!-- Game Board Container -->
          <div class="board-container">
            <!-- Opponent Territory Label -->
            <div class="territory-label opponent-territory">
              <h3>Opponent Territory</h3>
            </div>
            
            <!-- The Game Board -->
            <div class="battlefield" id="battlefield">
              <canvas id="game-canvas" width="900" height="900"></canvas>
              
              <!-- Hover Info Tooltip -->
              <div id="hover-tooltip" class="hover-tooltip hidden">
                <div class="tooltip-content"></div>
              </div>
              
              <!-- Grid Overlay (optional) -->
              <div id="grid-overlay" class="grid-overlay"></div>
            </div>
            
            <!-- Your Territory Label -->
            <div class="territory-label your-territory">
              <h3>Your Territory</h3>
            </div>
          </div>
          
          <!-- Right Sidebar - Game Log -->
          <div class="game-log-panel">
            <h3>Battle Log</h3>
            <div id="game-log" class="game-log">
              <div class="log-entry system">Game started!</div>
            </div>
            <button id="clear-log-btn" class="action-btn secondary small">Clear Log</button>
          </div>
        </div>
        
        <!-- Bottom Section - Hand and Card Actions -->
        <div class="hand-section">
          <div class="hand-header">
            <h3>Your Hand</h3>
            <div class="hand-stats">
              <span>Cards: <span id="hand-count">0</span></span>
              <span>Deck: <span id="deck-count">0</span></span>
            </div>
          </div>
          
          <div class="hand-container">
            <div class="hand-cards" id="hand-cards">
              <!-- Hand cards will be populated here -->
            </div>
          </div>
          
          <!-- Card Placement Target Indicator -->
          <div id="placement-indicator" class="placement-indicator hidden">
            <div class="indicator-content">
              <span>Click on the board to place card</span>
              <button id="cancel-placement-btn" class="cancel-btn">Cancel</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Card Draw Modal -->
    <div class="card-drawer hidden" id="card-drawer">
      <div class="drawer-content">
        <div class="drawer-header">
          <h2>Test Hand</h2>
          <div class="drawer-info" id="deck-draw-info">Cards remaining: 0</div>
        </div>
        <div class="drawn-cards" id="drawn-cards"></div>
        <div class="drawer-controls">
          <button id="draw-more-btn">Draw More</button>
          <button id="shuffle-deck-btn">Shuffle & Redraw</button>
          <button id="close-drawer-btn">Close</button>
        </div>
      </div>
    </div>

    <!-- Game Messages and Notifications -->
    <div class="message-overlay hidden" id="message-overlay">
      <div class="message-content" id="message-content"></div>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay hidden" id="loading-overlay">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loading-text">Loading...</div>
      </div>
    </div>
    
    <!-- Confirmation Dialog -->
    <div class="confirmation-dialog hidden" id="confirmation-dialog">
      <div class="dialog-content">
        <div class="dialog-header">
          <h3 id="confirmation-title">Confirm Action</h3>
        </div>
        <div class="dialog-body">
          <p id="confirmation-message">Are you sure?</p>
        </div>
        <div class="dialog-actions">
          <button id="confirm-yes-btn" class="action-btn">Yes</button>
          <button id="confirm-no-btn" class="action-btn secondary">No</button>
        </div>
      </div>
    </div>
    
    <script src="/socket.io/socket.io.js"></script>
    <script src="card-classes.js"></script>
    <script src="game-logic.js"></script>
    <script src="board-renderer.js"></script>
    <script src="interactions.js"></script>
    <script src="setup.js"></script>
    <script src="lobby.js"></script>
  </div>
</body>
</html>